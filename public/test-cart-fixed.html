<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cart Fixed</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-5">Test Cart Fixed</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Cart Fixes Applied</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h6>‚úÖ Fixed Issues:</h6>
                            <ul class="mb-0">
                                <li><strong>Independent Operation:</strong> Cart works without product detail dependencies</li>
                                <li><strong>Local Storage Only:</strong> No server API calls for cart operations</li>
                                <li><strong>Stock Management:</strong> Proper stock restore when removing items</li>
                                <li><strong>Product Names:</strong> Fixed undefined names issue</li>
                                <li><strong>Cart Count:</strong> Accurate count calculation</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Actions</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-2" onclick="createTestCart()">Create Test Cart</button>
                        <button class="btn btn-success mb-2" onclick="testIncreaseQuantity()">Test Increase</button>
                        <button class="btn btn-warning mb-2" onclick="testDecreaseQuantity()">Test Decrease</button>
                        <button class="btn btn-danger mb-2" onclick="testRemoveItem()">Test Remove</button>
                        <button class="btn btn-info mb-2" onclick="testClearAll()">Test Clear All</button>
                        
                        <div id="test-results" class="mt-3">
                            <p class="text-muted">Click buttons to test...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Current Cart Data</h5>
                    </div>
                    <div class="card-body">
                        <div id="cart-display">
                            <p class="text-muted">Cart data will appear here...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Cart Page</h5>
                    </div>
                    <div class="card-body">
                        <a href="http://localhost:8000/giohang" target="_blank" class="btn btn-success mb-3">
                            <i class="fas fa-external-link-alt"></i> Test Cart Page
                        </a>
                        
                        <div class="alert alert-info">
                            <h6>üìã Expected Results:</h6>
                            <ul class="mb-0">
                                <li>‚úÖ Product names display correctly (not "undefined")</li>
                                <li>‚úÖ Quantity increase/decrease buttons work</li>
                                <li>‚úÖ Quantity input field updates correctly</li>
                                <li>‚úÖ Individual item removal works</li>
                                <li>‚úÖ "X√≥a t·∫•t c·∫£" button works</li>
                                <li>‚úÖ Cart count in header updates correctly</li>
                                <li>‚úÖ Stock is restored when items are removed</li>
                                <li>‚úÖ No server API errors</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Mock cart data
        let testCartItems = [];
        
        function createTestCart() {
            testCartItems = [
                {
                    product_id: 106,
                    variant_id: 0,
                    quantity: 2,
                    name: 'Qu·∫ßn thun',
                    price: 500000,
                    image: '/backend/img/p1.jpg',
                    color_name: null,
                    size_name: null
                },
                {
                    product_id: 106,
                    variant_id: 136,
                    quantity: 1,
                    name: 'Qu·∫ßn thun',
                    price: 22222,
                    image: '/backend/img/p1.jpg',
                    color_name: 'ƒê·ªè',
                    size_name: '38'
                },
                {
                    product_id: 106,
                    variant_id: 137,
                    quantity: 3,
                    name: 'Qu·∫ßn thun',
                    price: 22222,
                    image: '/backend/img/p1.jpg',
                    color_name: 'ƒê·ªè',
                    size_name: '39'
                }
            ];
            
            localStorage.setItem('cart_data', JSON.stringify(testCartItems));
            updateCartDisplay();
            
            document.getElementById('test-results').innerHTML = `
                <div class="alert alert-success">
                    <h6>‚úÖ Test Cart Created:</h6>
                    <p>3 items added to cart</p>
                    <p>1 main product + 2 variants</p>
                </div>
            `;
        }
        
        function testIncreaseQuantity() {
            if (testCartItems.length === 0) {
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-warning">
                        <h6>‚ö†Ô∏è No Items:</h6>
                        <p>Create test cart first</p>
                    </div>
                `;
                return;
            }
            
            const firstItem = testCartItems[0];
            firstItem.quantity += 1;
            
            localStorage.setItem('cart_data', JSON.stringify(testCartItems));
            updateCartDisplay();
            
            document.getElementById('test-results').innerHTML = `
                <div class="alert alert-success">
                    <h6>‚ûï Quantity Increased:</h6>
                    <p>Item: ${firstItem.name}</p>
                    <p>New Quantity: ${firstItem.quantity}</p>
                </div>
            `;
        }
        
        function testDecreaseQuantity() {
            if (testCartItems.length === 0) {
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-warning">
                        <h6>‚ö†Ô∏è No Items:</h6>
                        <p>Create test cart first</p>
                    </div>
                `;
                return;
            }
            
            const firstItem = testCartItems[0];
            if (firstItem.quantity > 1) {
                firstItem.quantity -= 1;
                localStorage.setItem('cart_data', JSON.stringify(testCartItems));
                updateCartDisplay();
                
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-success">
                        <h6>‚ûñ Quantity Decreased:</h6>
                        <p>Item: ${firstItem.name}</p>
                        <p>New Quantity: ${firstItem.quantity}</p>
                    </div>
                `;
            } else {
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-warning">
                        <h6>‚ö†Ô∏è Cannot Decrease:</h6>
                        <p>Quantity is already at minimum (1)</p>
                    </div>
                `;
            }
        }
        
        function testRemoveItem() {
            if (testCartItems.length === 0) {
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-warning">
                        <h6>‚ö†Ô∏è No Items:</h6>
                        <p>Create test cart first</p>
                    </div>
                `;
                return;
            }
            
            const removedItem = testCartItems.shift();
            localStorage.setItem('cart_data', JSON.stringify(testCartItems));
            updateCartDisplay();
            
            document.getElementById('test-results').innerHTML = `
                <div class="alert alert-danger">
                    <h6>üóëÔ∏è Item Removed:</h6>
                    <p>Removed: ${removedItem.name}</p>
                    <p>Remaining items: ${testCartItems.length}</p>
                </div>
            `;
        }
        
        function testClearAll() {
            testCartItems = [];
            localStorage.removeItem('cart_data');
            updateCartDisplay();
            
            document.getElementById('test-results').innerHTML = `
                <div class="alert alert-danger">
                    <h6>üóëÔ∏è Cart Cleared:</h6>
                    <p>All items removed</p>
                    <p>Cart is now empty</p>
                </div>
            `;
        }
        
        function updateCartDisplay() {
            const cartData = localStorage.getItem('cart_data');
            let cartItems = [];
            
            if (cartData) {
                try {
                    cartItems = JSON.parse(cartData);
                } catch (error) {
                    console.error('Error parsing cart data:', error);
                }
            }
            
            const totalQuantity = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            document.getElementById('cart-display').innerHTML = `
                <div class="alert alert-info">
                    <h6>üìä Cart Summary:</h6>
                    <p><strong>Total Items:</strong> ${cartItems.length}</p>
                    <p><strong>Total Quantity:</strong> ${totalQuantity}</p>
                    <p><strong>Total Price:</strong> ${new Intl.NumberFormat('vi-VN').format(totalPrice)}‚Ç´</p>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Type</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cartItems.map(item => `
                                <tr>
                                    <td>${item.name}</td>
                                    <td>
                                        <span class="badge ${item.variant_id ? 'bg-info' : 'bg-primary'}">
                                            ${item.variant_id ? 'Bi·∫øn th·ªÉ' : 'S·∫£n ph·∫©m ch√≠nh'}
                                        </span>
                                    </td>
                                    <td>${new Intl.NumberFormat('vi-VN').format(item.price)}‚Ç´</td>
                                    <td>${item.quantity}</td>
                                    <td>${new Intl.NumberFormat('vi-VN').format(item.price * item.quantity)}‚Ç´</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // Auto-update on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Cart fixed test page loaded');
            updateCartDisplay();
        });
    </script>
</body>
</html>
