<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug API System</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-5">Debug API System</h1>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>API System Debug</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" onclick="debugAPISystem()">Debug API System</button>
                        
                        <div id="debug-result" class="mt-3">
                            <p class="text-muted">Click button to debug...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test API Endpoints</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-info mb-2" onclick="testAPIEndpoint('/api/products/106')">Test Product API</button>
                        <button class="btn btn-info mb-2" onclick="testAPIEndpoint('/api/home')">Test Home API</button>
                        <button class="btn btn-info mb-2" onclick="testAPIEndpoint('/api/categories')">Test Categories API</button>
                        
                        <div id="api-test-result" class="mt-3">
                            <p class="text-muted">Click buttons to test...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test JavaScript Files</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-success mb-2" onclick="testJSFile('/fontend/js/api/product-detail-api-client.js')">Test Product Detail Client</button>
                        <button class="btn btn-success mb-2" onclick="testJSFile('/fontend/js/product-detail-api.js')">Test Product Detail Manager</button>
                        <button class="btn btn-success mb-2" onclick="testJSFile('/fontend/js/api/index.js')">Test API Index</button>
                        
                        <div id="js-test-result" class="mt-3">
                            <p class="text-muted">Click buttons to test...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function debugAPISystem() {
            const resultDiv = document.getElementById('debug-result');
            resultDiv.innerHTML = '<p class="text-info">Debugging API system...</p>';
            
            try {
                console.log('=== DEBUGGING API SYSTEM ===');
                
                // Test 1: Check if Laravel server is running
                const serverTest = await testServer();
                
                // Test 2: Check if API endpoints are accessible
                const apiTest = await testAPIEndpoints();
                
                // Test 3: Check if JavaScript files are accessible
                const jsTest = await testJavaScriptFiles();
                
                resultDiv.innerHTML = `
                    <div class="alert alert-info">
                        <h6>üñ•Ô∏è Server Status</h6>
                        <p><strong>Laravel Server:</strong> ${serverTest.status}</p>
                        <p><strong>Message:</strong> ${serverTest.message}</p>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6>üîå API Endpoints</h6>
                        <p><strong>Status:</strong> ${apiTest.status}</p>
                        <p><strong>Message:</strong> ${apiTest.message}</p>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6>üìú JavaScript Files</h6>
                        <p><strong>Status:</strong> ${jsTest.status}</p>
                        <p><strong>Message:</strong> ${jsTest.message}</p>
                    </div>
                    
                    <div class="alert alert-light">
                        <h6>üîß Next Steps</h6>
                        <p>1. If server is down: Start Laravel server</p>
                        <p>2. If API fails: Check routes and controllers</p>
                        <p>3. If JS fails: Check file paths and permissions</p>
                    </div>
                `;
                
            } catch (error) {
                console.error('Debug Error:', error);
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Debug Error!</h6>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function testServer() {
            try {
                const response = await fetch('http://localhost:8000/api/products/106', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    return {
                        status: '‚úÖ Running',
                        message: 'Laravel server is accessible'
                    };
                } else {
                    return {
                        status: '‚ö†Ô∏è Error',
                        message: `Server responded with status: ${response.status}`
                    };
                }
            } catch (error) {
                return {
                    status: '‚ùå Down',
                    message: `Server not accessible: ${error.message}`
                };
            }
        }
        
        async function testAPIEndpoints() {
            try {
                const endpoints = [
                    '/api/products/106',
                    '/api/home',
                    '/api/categories'
                ];
                
                let successCount = 0;
                let totalCount = endpoints.length;
                
                for (const endpoint of endpoints) {
                    try {
                        const response = await fetch(`http://localhost:8000${endpoint}`, {
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json',
                                'Content-Type': 'application/json'
                            }
                        });
                        
                        if (response.ok) {
                            successCount++;
                        }
                    } catch (error) {
                        console.error(`API endpoint ${endpoint} failed:`, error);
                    }
                }
                
                if (successCount === totalCount) {
                    return {
                        status: '‚úÖ All Working',
                        message: `${successCount}/${totalCount} endpoints accessible`
                    };
                } else {
                    return {
                        status: '‚ö†Ô∏è Partial',
                        message: `${successCount}/${totalCount} endpoints accessible`
                    };
                }
            } catch (error) {
                return {
                    status: '‚ùå Failed',
                    message: `API test failed: ${error.message}`
                };
            }
        }
        
        async function testJavaScriptFiles() {
            try {
                const files = [
                    '/fontend/js/api/product-detail-api-client.js',
                    '/fontend/js/product-detail-api.js',
                    '/fontend/js/api/index.js'
                ];
                
                let successCount = 0;
                let totalCount = files.length;
                
                for (const file of files) {
                    try {
                        const response = await fetch(`http://localhost:8000${file}`, {
                            method: 'GET'
                        });
                        
                        if (response.ok) {
                            successCount++;
                        }
                    } catch (error) {
                        console.error(`JS file ${file} failed:`, error);
                    }
                }
                
                if (successCount === totalCount) {
                    return {
                        status: '‚úÖ All Working',
                        message: `${successCount}/${totalCount} files accessible`
                    };
                } else {
                    return {
                        status: '‚ö†Ô∏è Partial',
                        message: `${successCount}/${totalCount} files accessible`
                    };
                }
            } catch (error) {
                return {
                    status: '‚ùå Failed',
                    message: `JS test failed: ${error.message}`
                };
            }
        }
        
        async function testAPIEndpoint(endpoint) {
            const resultDiv = document.getElementById('api-test-result');
            resultDiv.innerHTML = '<p class="text-info">Testing API endpoint...</p>';
            
            try {
                const response = await fetch(`http://localhost:8000${endpoint}`, {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (response.ok) {
                    const data = await response.json();
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h6>‚úÖ ${endpoint}</h6>
                            <p><strong>Status:</strong> ${response.status}</p>
                            <p><strong>Response:</strong> ${JSON.stringify(data, null, 2).substring(0, 200)}...</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <h6>‚ùå ${endpoint}</h6>
                            <p><strong>Status:</strong> ${response.status}</p>
                            <p><strong>Error:</strong> ${response.statusText}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå ${endpoint}</h6>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        async function testJSFile(file) {
            const resultDiv = document.getElementById('js-test-result');
            resultDiv.innerHTML = '<p class="text-info">Testing JS file...</p>';
            
            try {
                const response = await fetch(`http://localhost:8000${file}`, {
                    method: 'GET'
                });
                
                if (response.ok) {
                    const content = await response.text();
                    resultDiv.innerHTML = `
                        <div class="alert alert-success">
                            <h6>‚úÖ ${file}</h6>
                            <p><strong>Status:</strong> ${response.status}</p>
                            <p><strong>Size:</strong> ${content.length} characters</p>
                            <p><strong>Preview:</strong> ${content.substring(0, 100)}...</p>
                        </div>
                    `;
                } else {
                    resultDiv.innerHTML = `
                        <div class="alert alert-danger">
                            <h6>‚ùå ${file}</h6>
                            <p><strong>Status:</strong> ${response.status}</p>
                            <p><strong>Error:</strong> ${response.statusText}</p>
                        </div>
                    `;
                }
            } catch (error) {
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå ${file}</h6>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Auto-debug on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Debug page loaded');
        });
    </script>
</body>
</html>
