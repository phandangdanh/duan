<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cart Simple</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-5">Test Cart Simple - No Stock Validation</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Current Cart Data</h5>
                    </div>
                    <div class="card-body">
                        <div id="cart-display">
                            <p class="text-muted">Cart data will appear here...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Actions</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-2" onclick="createTestCart()">Create Test Cart</button>
                        <button class="btn btn-success mb-2" onclick="testUpdateQuantity()">Test Update Quantity</button>
                        <button class="btn btn-warning mb-2" onclick="testRemoveItem()">Test Remove Item</button>
                        <button class="btn btn-danger mb-2" onclick="testClearCart()">Test Clear Cart</button>
                        
                        <div id="test-results" class="mt-3">
                            <p class="text-muted">Click buttons to test...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Cart Functions</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h6>‚úÖ Fixed Issues:</h6>
                            <ul class="mb-0">
                                <li>‚úÖ <strong>No Cart Manager:</strong> Direct localStorage operations</li>
                                <li>‚úÖ <strong>No Stock Validation:</strong> Allow any quantity</li>
                                <li>‚úÖ <strong>Simple Functions:</strong> updateQuantity, removeFromCart, clearCart</li>
                                <li>‚úÖ <strong>No Error Messages:</strong> No "kh√¥ng ƒë·ªß h√†ng" messages</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Pages</h5>
                    </div>
                    <div class="card-body">
                        <a href="http://localhost:8000/giohang" target="_blank" class="btn btn-primary mb-3">
                            <i class="fas fa-external-link-alt"></i> Test Cart Page
                        </a>
                        
                        <div class="alert alert-info">
                            <h6>üîç Expected Results:</h6>
                            <ul class="mb-0">
                                <li>‚úÖ <strong>No "Cart Manager not available":</strong> Direct localStorage operations</li>
                                <li>‚úÖ <strong>No Stock Messages:</strong> No "kh√¥ng ƒë·ªß h√†ng" notifications</li>
                                <li>‚úÖ <strong>Quantity Updates:</strong> Any quantity allowed</li>
                                <li>‚úÖ <strong>Simple Notifications:</strong> Only success/error messages</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function createTestCart() {
            const testCart = [
                {
                    product_id: 106,
                    variant_id: 0,
                    quantity: 5,
                    name: 'Qu·∫ßn thun',
                    price: 500000,
                    image: '/backend/img/p1.jpg',
                    color_name: null,
                    size_name: null
                },
                {
                    product_id: 106,
                    variant_id: 136,
                    quantity: 3,
                    name: 'Qu·∫ßn thun',
                    price: 22222,
                    image: '/backend/img/p1.jpg',
                    color_name: 'ƒê·ªè',
                    size_name: '38'
                }
            ];
            
            localStorage.setItem('cart_data', JSON.stringify(testCart));
            
            document.getElementById('test-results').innerHTML = `
                <div class="alert alert-success">
                    <h6>‚úÖ Test Cart Created:</h6>
                    <p>2 items: Main product (5) + Variant (3)</p>
                    <p>Total quantity: 8</p>
                </div>
            `;
            
            displayCartData();
        }
        
        function testUpdateQuantity() {
            // Simulate updateQuantity function
            const productId = 106;
            const variantId = 0;
            const quantity = 10; // Try to set to 10 (should work without stock validation)
            
            try {
                const cartData = localStorage.getItem('cart_data');
                let cartItems = [];
                
                if (cartData) {
                    cartItems = JSON.parse(cartData);
                }
                
                const itemIndex = cartItems.findIndex(item => 
                    item.product_id === productId && item.variant_id === variantId
                );
                
                if (itemIndex !== -1) {
                    cartItems[itemIndex].quantity = quantity;
                    localStorage.setItem('cart_data', JSON.stringify(cartItems));
                    
                    document.getElementById('test-results').innerHTML = `
                        <div class="alert alert-success">
                            <h6>‚úÖ Quantity Updated:</h6>
                            <p>Product ${productId} (variant ${variantId}): ${quantity}</p>
                            <p>No stock validation - any quantity allowed!</p>
                        </div>
                    `;
                } else {
                    document.getElementById('test-results').innerHTML = `
                        <div class="alert alert-warning">
                            <h6>‚ö†Ô∏è Item Not Found:</h6>
                            <p>Create test cart first</p>
                        </div>
                    `;
                }
                
            } catch (error) {
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Error:</h6>
                        <p>${error.message}</p>
                    </div>
                `;
            }
            
            displayCartData();
        }
        
        function testRemoveItem() {
            const productId = 106;
            const variantId = 136;
            
            try {
                const cartData = localStorage.getItem('cart_data');
                let cartItems = [];
                
                if (cartData) {
                    cartItems = JSON.parse(cartData);
                }
                
                cartItems = cartItems.filter(item => 
                    !(item.product_id === productId && item.variant_id === variantId)
                );
                
                localStorage.setItem('cart_data', JSON.stringify(cartItems));
                
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-success">
                        <h6>‚úÖ Item Removed:</h6>
                        <p>Product ${productId} (variant ${variantId}) removed</p>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Error:</h6>
                        <p>${error.message}</p>
                    </div>
                `;
            }
            
            displayCartData();
        }
        
        function testClearCart() {
            try {
                localStorage.setItem('cart_data', JSON.stringify([]));
                
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-success">
                        <h6>‚úÖ Cart Cleared:</h6>
                        <p>All items removed from cart</p>
                    </div>
                `;
                
            } catch (error) {
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Error:</h6>
                        <p>${error.message}</p>
                    </div>
                `;
            }
            
            displayCartData();
        }
        
        function displayCartData() {
            const cartData = localStorage.getItem('cart_data');
            let cartItems = [];
            
            if (cartData) {
                try {
                    cartItems = JSON.parse(cartData);
                } catch (error) {
                    console.error('Error parsing cart data:', error);
                }
            }
            
            if (cartItems.length === 0) {
                document.getElementById('cart-display').innerHTML = `
                    <div class="alert alert-info">
                        <h6>üì≠ Empty Cart</h6>
                        <p>No items in cart</p>
                    </div>
                `;
                return;
            }
            
            const totalQuantity = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            document.getElementById('cart-display').innerHTML = `
                <div class="alert alert-info">
                    <h6>üõí Cart Summary:</h6>
                    <p><strong>Total Items:</strong> ${cartItems.length}</p>
                    <p><strong>Total Quantity:</strong> ${totalQuantity}</p>
                    <p><strong>Total Price:</strong> ${new Intl.NumberFormat('vi-VN').format(totalPrice)}‚Ç´</p>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Product</th>
                                <th>Type</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cartItems.map(item => `
                                <tr>
                                    <td>${item.name || 'S·∫£n ph·∫©m'}</td>
                                    <td>
                                        <span class="badge ${item.variant_id ? 'bg-info' : 'bg-primary'}">
                                            ${item.variant_id ? 'Bi·∫øn th·ªÉ' : 'S·∫£n ph·∫©m ch√≠nh'}
                                        </span>
                                    </td>
                                    <td>${new Intl.NumberFormat('vi-VN').format(item.price)}‚Ç´</td>
                                    <td>${item.quantity}</td>
                                    <td>${new Intl.NumberFormat('vi-VN').format(item.price * item.quantity)}‚Ç´</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // Auto-load on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Cart simple test page loaded');
            displayCartData();
        });
    </script>
</body>
</html>
