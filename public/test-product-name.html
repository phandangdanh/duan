<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Product Name</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-5">Test Product Name Fix</h1>
        
        <div class="row">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Product Name Fix</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h6>‚úÖ Fixed Product Name:</h6>
                            <ul class="mb-0">
                                <li><strong>Priority Order:</strong> tenSP ‚Üí ten ‚Üí name ‚Üí 'S·∫£n ph·∫©m'</li>
                                <li><strong>Cart Items:</strong> Correct product names</li>
                                <li><strong>Product Title:</strong> Consistent naming</li>
                                <li><strong>No More "undefined":</strong> Fallback to 'S·∫£n ph·∫©m'</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Actions</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-2" onclick="testProductName()">Test Product Name</button>
                        <button class="btn btn-success mb-2" onclick="createTestCart()">Create Test Cart</button>
                        <button class="btn btn-warning mb-2" onclick="fixExistingCart()">Fix Existing Cart</button>
                        
                        <div id="test-results" class="mt-3">
                            <p class="text-muted">Click buttons to test...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Current Cart Data</h5>
                    </div>
                    <div class="card-body">
                        <div id="cart-display">
                            <p class="text-muted">Cart data will appear here...</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Product Name Priority</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6>üìã Name Priority Order:</h6>
                            <ol class="mb-0">
                                <li><strong>tenSP</strong> - T√™n s·∫£n ph·∫©m ch√≠nh</li>
                                <li><strong>ten</strong> - T√™n s·∫£n ph·∫©m ph·ª•</li>
                                <li><strong>name</strong> - T√™n ti·∫øng Anh</li>
                                <li><strong>'S·∫£n ph·∫©m'</strong> - Fallback</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Pages</h5>
                    </div>
                    <div class="card-body">
                        <a href="http://localhost:8000/sanpham-api/106" target="_blank" class="btn btn-primary mb-3">
                            <i class="fas fa-external-link-alt"></i> Test Product Detail
                        </a>
                        
                        <a href="http://localhost:8000/giohang" target="_blank" class="btn btn-success mb-3">
                            <i class="fas fa-external-link-alt"></i> Test Cart Page
                        </a>
                        
                        <div class="alert alert-info">
                            <h6>üîç Expected Results:</h6>
                            <ul class="mb-0">
                                <li>‚úÖ <strong>Product Title:</strong> "Qu·∫ßn thun" (not "undefined")</li>
                                <li>‚úÖ <strong>Cart Items:</strong> "Qu·∫ßn thun" (not "undefined")</li>
                                <li>‚úÖ <strong>Consistent Naming:</strong> Same name everywhere</li>
                                <li>‚úÖ <strong>Fallback:</strong> "S·∫£n ph·∫©m" if no name found</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        function testProductName() {
            // Simulate product data
            const productData = {
                id: 106,
                tenSP: 'Qu·∫ßn thun',
                ten: 'Qu·∫ßn thun ph·ª•',
                name: 'Pants',
                moTa: 'qu·∫ßn thun'
            };
            
            // Test name priority
            const productName = productData.tenSP || productData.ten || productData.name || 'S·∫£n ph·∫©m';
            
            document.getElementById('test-results').innerHTML = `
                <div class="alert alert-success">
                    <h6>‚úÖ Product Name Test:</h6>
                    <p><strong>Product Data:</strong></p>
                    <ul class="mb-2">
                        <li>tenSP: "${productData.tenSP}"</li>
                        <li>ten: "${productData.ten}"</li>
                        <li>name: "${productData.name}"</li>
                    </ul>
                    <p><strong>Selected Name:</strong> "${productName}"</p>
                </div>
            `;
        }
        
        function createTestCart() {
            // Create test cart with correct product names
            const testCart = [
                {
                    product_id: 106,
                    variant_id: 0,
                    quantity: 2,
                    name: 'Qu·∫ßn thun',
                    price: 500000,
                    image: '/backend/img/p1.jpg',
                    color_name: null,
                    size_name: null
                },
                {
                    product_id: 106,
                    variant_id: 136,
                    quantity: 1,
                    name: 'Qu·∫ßn thun',
                    price: 22222,
                    image: '/backend/img/p1.jpg',
                    color_name: 'ƒê·ªè',
                    size_name: '38'
                }
            ];
            
            localStorage.setItem('cart_data', JSON.stringify(testCart));
            
            document.getElementById('test-results').innerHTML = `
                <div class="alert alert-success">
                    <h6>‚úÖ Test Cart Created:</h6>
                    <p>Cart with correct product names</p>
                    <p>2 items: Main product + Variant</p>
                </div>
            `;
            
            displayCartData();
        }
        
        function fixExistingCart() {
            const cartData = localStorage.getItem('cart_data');
            let cartItems = [];
            
            if (cartData) {
                try {
                    cartItems = JSON.parse(cartData);
                } catch (error) {
                    console.error('Error parsing cart data:', error);
                }
            }
            
            if (cartItems.length === 0) {
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-warning">
                        <h6>‚ö†Ô∏è No Cart Data:</h6>
                        <p>No items to fix</p>
                    </div>
                `;
                return;
            }
            
            // Fix product names
            let fixedCount = 0;
            cartItems.forEach(item => {
                if (!item.name || item.name === 'undefined') {
                    item.name = 'Qu·∫ßn thun'; // Use correct product name
                    fixedCount++;
                }
            });
            
            if (fixedCount > 0) {
                localStorage.setItem('cart_data', JSON.stringify(cartItems));
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-success">
                        <h6>‚úÖ Cart Names Fixed:</h6>
                        <p>Fixed ${fixedCount} items with incorrect names</p>
                        <p>All items now have correct product names</p>
                    </div>
                `;
            } else {
                document.getElementById('test-results').innerHTML = `
                    <div class="alert alert-info">
                        <h6>‚ÑπÔ∏è No Fix Needed:</h6>
                        <p>All product names are already correct</p>
                    </div>
                `;
            }
            
            displayCartData();
        }
        
        function displayCartData() {
            const cartData = localStorage.getItem('cart_data');
            let cartItems = [];
            
            if (cartData) {
                try {
                    cartItems = JSON.parse(cartData);
                } catch (error) {
                    console.error('Error parsing cart data:', error);
                }
            }
            
            if (cartItems.length === 0) {
                document.getElementById('cart-display').innerHTML = `
                    <div class="alert alert-info">
                        <h6>üì≠ Empty Cart</h6>
                        <p>No items in cart</p>
                    </div>
                `;
                return;
            }
            
            const totalQuantity = cartItems.reduce((sum, item) => sum + item.quantity, 0);
            const totalPrice = cartItems.reduce((sum, item) => sum + (item.price * item.quantity), 0);
            
            document.getElementById('cart-display').innerHTML = `
                <div class="alert alert-info">
                    <h6>üìä Cart Summary:</h6>
                    <p><strong>Total Items:</strong> ${cartItems.length}</p>
                    <p><strong>Total Quantity:</strong> ${totalQuantity}</p>
                    <p><strong>Total Price:</strong> ${new Intl.NumberFormat('vi-VN').format(totalPrice)}‚Ç´</p>
                </div>
                <div class="table-responsive">
                    <table class="table table-sm">
                        <thead>
                            <tr>
                                <th>Product Name</th>
                                <th>Type</th>
                                <th>Price</th>
                                <th>Quantity</th>
                                <th>Total</th>
                            </tr>
                        </thead>
                        <tbody>
                            ${cartItems.map(item => `
                                <tr class="${item.name === 'undefined' || !item.name ? 'table-warning' : ''}">
                                    <td class="${item.name === 'undefined' || !item.name ? 'text-danger' : ''}">
                                        ${item.name || 'undefined'}
                                    </td>
                                    <td>
                                        <span class="badge ${item.variant_id ? 'bg-info' : 'bg-primary'}">
                                            ${item.variant_id ? 'Bi·∫øn th·ªÉ' : 'S·∫£n ph·∫©m ch√≠nh'}
                                        </span>
                                    </td>
                                    <td>${new Intl.NumberFormat('vi-VN').format(item.price)}‚Ç´</td>
                                    <td>${item.quantity}</td>
                                    <td>${new Intl.NumberFormat('vi-VN').format(item.price * item.quantity)}‚Ç´</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            `;
        }
        
        // Auto-load on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Product name test page loaded');
            displayCartData();
        });
    </script>
</body>
</html>
