<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test LocalStorage Stock Management</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-5">Test LocalStorage Stock Management</h1>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>LocalStorage Stock Test</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" onclick="testLocalStorage()">Test LocalStorage</button>
                        <button class="btn btn-warning mb-3" onclick="clearLocalStorage()">Clear LocalStorage</button>
                        
                        <div id="test-result" class="mt-3">
                            <p class="text-muted">Click button to test...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>LocalStorage Features</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h6>‚úÖ LocalStorage Features:</h6>
                            <ul class="mb-0">
                                <li><strong>Stock Tracking:</strong> L∆∞u s·ªë l∆∞·ª£ng ƒë√£ th√™m v√†o gi·ªè</li>
                                <li><strong>Persistent:</strong> Kh√¥ng m·∫•t khi reset trang</li>
                                <li><strong>Auto Switch:</strong> Chuy·ªÉn sang m√†u khi h·∫øt h√†ng</li>
                                <li><strong>Real-time Update:</strong> C·∫≠p nh·∫≠t display ngay l·∫≠p t·ª©c</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Scenarios</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6>üìä Test Scenarios:</h6>
                            <ol class="mb-0">
                                <li>Th√™m s·∫£n ph·∫©m ch√≠nh v√†o gi·ªè</li>
                                <li>Ki·ªÉm tra stock gi·∫£m</li>
                                <li>Th√™m h·∫øt s·∫£n ph·∫©m ch√≠nh</li>
                                <li>Ki·ªÉm tra th√¥ng b√°o h·∫øt h√†ng</li>
                                <li>Ki·ªÉm tra auto-switch sang m√†u</li>
                                <li>Reset trang v√† ki·ªÉm tra stock</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Product Detail Page</h5>
                    </div>
                    <div class="card-body">
                        <a href="http://localhost:8000/sanpham/106" target="_blank" class="btn btn-info mb-3">
                            <i class="fas fa-external-link-alt"></i> Open Product Detail Page
                        </a>
                        
                        <div class="alert alert-info">
                            <h6>üìã Test Steps:</h6>
                            <ol class="mb-0">
                                <li>M·ªü trang product detail</li>
                                <li>Th√™m s·∫£n ph·∫©m ch√≠nh v√†o gi·ªè (quantity: 5)</li>
                                <li>Ki·ªÉm tra "S·ªë l∆∞·ª£ng c√≥ s·∫µn" gi·∫£m t·ª´ 10 xu·ªëng 5</li>
                                <li>Th√™m th√™m 5 s·∫£n ph·∫©m n·ªØa (h·∫øt h√†ng)</li>
                                <li>Ki·ªÉm tra th√¥ng b√°o "S·∫£n ph·∫©m ch√≠nh ƒë√£ h·∫øt h√†ng"</li>
                                <li>Ki·ªÉm tra auto-select m√†u ƒë·∫ßu ti√™n</li>
                                <li>Reset trang v√† ki·ªÉm tra stock v·∫´n gi·ªØ nguy√™n</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function testLocalStorage() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<p class="text-info">Testing localStorage...</p>';
            
            try {
                console.log('=== TESTING LOCALSTORAGE ===');
                
                // Test localStorage functionality
                const testKey = 'test_stock_106';
                const testData = {
                    mainStock: 5,
                    variants: {
                        '1_1': 3,
                        '1_2': 2
                    }
                };
                
                // Save test data
                localStorage.setItem(testKey, JSON.stringify(testData));
                
                // Retrieve test data
                const retrieved = JSON.parse(localStorage.getItem(testKey));
                
                // Check if data matches
                const isWorking = JSON.stringify(testData) === JSON.stringify(retrieved);
                
                // Get all localStorage keys related to products
                const productKeys = Object.keys(localStorage).filter(key => key.startsWith('product_stock_'));
                
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h6>‚úÖ LocalStorage Test Results</h6>
                        <p><strong>LocalStorage Working:</strong> ${isWorking ? 'Yes' : 'No'}</p>
                        <p><strong>Test Data Saved:</strong> ${JSON.stringify(testData)}</p>
                        <p><strong>Test Data Retrieved:</strong> ${JSON.stringify(retrieved)}</p>
                        <p><strong>Product Keys Found:</strong> ${productKeys.length}</p>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6>üîç Current Product Stock Keys:</h6>
                        <ul class="mb-0">
                            ${productKeys.map(key => `<li>${key}: ${localStorage.getItem(key)}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="alert alert-success">
                        <h6>‚úÖ Expected Behavior:</h6>
                        <ul class="mb-0">
                            <li>‚úÖ Stock decreases when adding to cart</li>
                            <li>‚úÖ Stock persists after page refresh</li>
                            <li>‚úÖ Auto-switch to variants when main product out of stock</li>
                            <li>‚úÖ Real-time display updates</li>
                            <li>‚úÖ localStorage key format: product_stock_{productId}</li>
                        </ul>
                    </div>
                `;
                
                // Clean up test data
                localStorage.removeItem(testKey);
                
            } catch (error) {
                console.error('Test Error:', error);
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Test Error!</h6>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        function clearLocalStorage() {
            const productKeys = Object.keys(localStorage).filter(key => key.startsWith('product_stock_'));
            
            if (productKeys.length > 0) {
                productKeys.forEach(key => localStorage.removeItem(key));
                alert(`Cleared ${productKeys.length} product stock entries from localStorage`);
            } else {
                alert('No product stock entries found in localStorage');
            }
            
            // Refresh test
            testLocalStorage();
        }
        
        // Auto-test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('LocalStorage test page loaded');
            testLocalStorage();
        });
    </script>
</body>
</html>
