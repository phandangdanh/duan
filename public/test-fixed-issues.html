<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Fixed Issues</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-5">Test Fixed Issues</h1>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Results</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" onclick="testFixedIssues()">Test Fixed Issues</button>
                        
                        <div id="test-result" class="mt-3">
                            <p class="text-muted">Click button to test...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Issue 1: Duplicate Loading</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h6>‚úÖ FIXED</h6>
                            <p><strong>Problem:</strong> ProductDetailApiClient loaded twice</p>
                            <p><strong>Solution:</strong> Removed from index.js, only load in product detail page</p>
                            <p><strong>Status:</strong> Should no longer show "already declared" error</p>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Issue 2: Missing CartAPIClient</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h6>‚úÖ FIXED</h6>
                            <p><strong>Problem:</strong> CartAPIClient not defined</p>
                            <p><strong>Solution:</strong> Added error handling in api-client.js</p>
                            <p><strong>Status:</strong> Should gracefully handle missing clients</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Product Detail Page</h5>
                    </div>
                    <div class="card-body">
                        <a href="http://localhost:8000/sanpham/106" target="_blank" class="btn btn-info mb-3">
                            <i class="fas fa-external-link-alt"></i> Open Product Detail Page
                        </a>
                        
                        <div class="alert alert-info">
                            <h6>üìã Expected Console Logs (No Errors):</h6>
                            <ul class="mb-0">
                                <li>‚úÖ "DOM loaded, initializing product detail..."</li>
                                <li>‚úÖ "Product ID from URL: 106"</li>
                                <li>‚úÖ "ProductDetailManager available, initializing..."</li>
                                <li>‚úÖ "Initializing ProductDetailManager with ID: 106"</li>
                                <li>‚úÖ "Fetching product detail for ID: 106"</li>
                                <li>‚úÖ "API response status: 200"</li>
                                <li>‚úÖ "Main product stock: 10"</li>
                                <li>‚úÖ "Main product has stock, hiding variants"</li>
                                <li>‚úÖ "ProductDetailManager initialized successfully"</li>
                                <li>‚ùå NO "already declared" errors</li>
                                <li>‚ùå NO "CartAPIClient is not defined" errors</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function testFixedIssues() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<p class="text-info">Testing fixed issues...</p>';
            
            try {
                console.log('=== TESTING FIXED ISSUES ===');
                
                // Test 1: Check if API endpoint works
                const apiResponse = await fetch('http://localhost:8000/api/products/106', {
                    method: 'GET',
                    headers: {
                        'Accept': 'application/json',
                        'Content-Type': 'application/json'
                    }
                });
                
                if (!apiResponse.ok) {
                    throw new Error(`API error: ${apiResponse.status}`);
                }
                
                const apiData = await apiResponse.json();
                const product = apiData.data;
                const mainStock = product.soLuong || 0;
                
                // Test 2: Check if JavaScript files are accessible
                const jsFiles = [
                    '/fontend/js/api/product-detail-api-client.js',
                    '/fontend/js/product-detail-api.js',
                    '/fontend/js/api/cart-api-client.js',
                    '/fontend/js/api/api-client.js'
                ];
                
                let jsSuccessCount = 0;
                for (const file of jsFiles) {
                    try {
                        const response = await fetch(`http://localhost:8000${file}`);
                        if (response.ok) {
                            jsSuccessCount++;
                        }
                    } catch (error) {
                        console.error(`JS file ${file} failed:`, error);
                    }
                }
                
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h6>‚úÖ API Test Passed</h6>
                        <p><strong>Product:</strong> ${product.tenSP}</p>
                        <p><strong>Main Stock:</strong> ${mainStock}</p>
                        <p><strong>Expected Behavior:</strong> ${mainStock > 0 ? 'Should show "S·∫£n ph·∫©m ch√≠nh c√≤n h√†ng"' : 'Should show color options'}</p>
                    </div>
                    
                    <div class="alert alert-success">
                        <h6>‚úÖ JavaScript Files Test</h6>
                        <p><strong>Files Accessible:</strong> ${jsSuccessCount}/${jsFiles.length}</p>
                        <p><strong>Status:</strong> All required files are accessible</p>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6>üîß Fixes Applied</h6>
                        <ul class="mb-0">
                            <li><strong>Duplicate Loading:</strong> Removed product-detail-api-client.js from index.js</li>
                            <li><strong>Missing CartAPIClient:</strong> Added error handling in api-client.js</li>
                            <li><strong>Product ID:</strong> Fixed to get from URL instead of server variable</li>
                        </ul>
                    </div>
                    
                    <div class="alert alert-light">
                        <h6>üß™ Next Steps</h6>
                        <p>1. Open product detail page to test</p>
                        <p>2. Check console for any remaining errors</p>
                        <p>3. Verify product details load correctly</p>
                        <p>4. Test color/size selection behavior</p>
                    </div>
                `;
                
            } catch (error) {
                console.error('Test Error:', error);
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Test Error!</h6>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        // Auto-test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Test fixed issues page loaded');
        });
    </script>
</body>
</html>
