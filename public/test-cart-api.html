<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Cart API</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-5">
        <h1 class="text-center mb-5">Test Cart API</h1>
        
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Cart API Test</h5>
                    </div>
                    <div class="card-body">
                        <button class="btn btn-primary mb-3" onclick="testCartAPI()">Test Cart API</button>
                        <button class="btn btn-warning mb-3" onclick="clearCartData()">Clear Cart Data</button>
                        
                        <div id="test-result" class="mt-3">
                            <p class="text-muted">Click button to test...</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>Cart API Features</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-success">
                            <h6>‚úÖ Cart API Features:</h6>
                            <ul class="mb-0">
                                <li><strong>LocalStorage Integration:</strong> L∆∞u/load cart t·ª´ localStorage</li>
                                <li><strong>Stock Sync:</strong> ƒê·ªìng b·ªô stock v·ªõi product detail</li>
                                <li><strong>Real-time Updates:</strong> C·∫≠p nh·∫≠t display ngay l·∫≠p t·ª©c</li>
                                <li><strong>Modal Management:</strong> Qu·∫£n l√Ω modal x√≥a</li>
                                <li><strong>Notification System:</strong> Th√¥ng b√°o th√†nh c√¥ng/l·ªói</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-6">
                <div class="card">
                    <div class="card-header">
                        <h5>File Structure</h5>
                    </div>
                    <div class="card-body">
                        <div class="alert alert-info">
                            <h6>üìÅ File Structure:</h6>
                            <ul class="mb-0">
                                <li><strong>View:</strong> resources/views/fontend/cart/giohang.blade.php</li>
                                <li><strong>JS:</strong> public/fontend/js/cart-api.js</li>
                                <li><strong>Class:</strong> CartAPIManager</li>
                                <li><strong>Global:</strong> window.cartAPIManager</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="row mt-4">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header">
                        <h5>Test Cart Page</h5>
                    </div>
                    <div class="card-body">
                        <a href="http://localhost:8000/cart" target="_blank" class="btn btn-info mb-3">
                            <i class="fas fa-external-link-alt"></i> Open Cart Page
                        </a>
                        
                        <div class="alert alert-info">
                            <h6>üìã Test Steps:</h6>
                            <ol class="mb-0">
                                <li>M·ªü trang product detail v√† th√™m s·∫£n ph·∫©m v√†o gi·ªè</li>
                                <li>M·ªü trang cart ƒë·ªÉ xem localStorage integration</li>
                                <li>Test update quantity trong cart</li>
                                <li>Test remove item t·ª´ cart</li>
                                <li>Test clear all cart</li>
                                <li>Ki·ªÉm tra stock sync v·ªõi product detail</li>
                            </ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        async function testCartAPI() {
            const resultDiv = document.getElementById('test-result');
            resultDiv.innerHTML = '<p class="text-info">Testing Cart API...</p>';
            
            try {
                console.log('=== TESTING CART API ===');
                
                // Test localStorage functionality
                const testCartData = [
                    {
                        product_id: 106,
                        variant_id: 0,
                        quantity: 2,
                        price: 500000,
                        name: 'Qu·∫ßn thun'
                    },
                    {
                        product_id: 106,
                        variant_id: 1,
                        quantity: 1,
                        price: 600000,
                        name: 'Qu·∫ßn thun - ƒê·ªè - M'
                    }
                ];
                
                // Save test data
                localStorage.setItem('cart_data', JSON.stringify(testCartData));
                
                // Retrieve test data
                const retrieved = JSON.parse(localStorage.getItem('cart_data'));
                
                // Check if data matches
                const isWorking = JSON.stringify(testCartData) === JSON.stringify(retrieved);
                
                // Get all localStorage keys related to cart and stock
                const cartKeys = Object.keys(localStorage).filter(key => 
                    key.startsWith('cart_') || key.startsWith('product_stock_')
                );
                
                resultDiv.innerHTML = `
                    <div class="alert alert-success">
                        <h6>‚úÖ Cart API Test Results</h6>
                        <p><strong>LocalStorage Working:</strong> ${isWorking ? 'Yes' : 'No'}</p>
                        <p><strong>Test Cart Data:</strong> ${JSON.stringify(testCartData)}</p>
                        <p><strong>Retrieved Data:</strong> ${JSON.stringify(retrieved)}</p>
                        <p><strong>Cart/Stock Keys Found:</strong> ${cartKeys.length}</p>
                    </div>
                    
                    <div class="alert alert-info">
                        <h6>üîç Current Cart/Stock Keys:</h6>
                        <ul class="mb-0">
                            ${cartKeys.map(key => `<li>${key}: ${localStorage.getItem(key)}</li>`).join('')}
                        </ul>
                    </div>
                    
                    <div class="alert alert-success">
                        <h6>‚úÖ Expected Behavior:</h6>
                        <ul class="mb-0">
                            <li>‚úÖ Cart data persists in localStorage</li>
                            <li>‚úÖ Stock data syncs with product detail</li>
                            <li>‚úÖ Cart updates reflect in localStorage</li>
                            <li>‚úÖ Stock updates reflect in localStorage</li>
                            <li>‚úÖ File naming follows convention: cart-api.js</li>
                        </ul>
                    </div>
                `;
                
            } catch (error) {
                console.error('Test Error:', error);
                resultDiv.innerHTML = `
                    <div class="alert alert-danger">
                        <h6>‚ùå Test Error!</h6>
                        <p><strong>Error:</strong> ${error.message}</p>
                    </div>
                `;
            }
        }
        
        function clearCartData() {
            const cartKeys = Object.keys(localStorage).filter(key => 
                key.startsWith('cart_') || key.startsWith('product_stock_')
            );
            
            if (cartKeys.length > 0) {
                cartKeys.forEach(key => localStorage.removeItem(key));
                alert(`Cleared ${cartKeys.length} cart/stock entries from localStorage`);
            } else {
                alert('No cart/stock entries found in localStorage');
            }
            
            // Refresh test
            testCartAPI();
        }
        
        // Auto-test on page load
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Cart API test page loaded');
            testCartAPI();
        });
    </script>
</body>
</html>
